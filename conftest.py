import subprocess
import pathlib
import pytest
import os


@pytest.fixture
def run_cli():
    def _run_cli(
        command_args, tmp_path, output_subdir="output", output_dir_arg="--out_dir"
    ):
        # Prepare the output directory
        output_dir = tmp_path / output_subdir
        output_dir.mkdir(exist_ok=True)

        # Append the output directory to the command arguments if necessary
        # This assumes your CLI accepts an '--output' argument
        if output_dir_arg not in command_args:
            command_args.extend([output_dir_arg, str(output_dir)])

        command_args = [str(cmd) for cmd in command_args]

        print(" ".join(command_args))

        # Run the command
        result = subprocess.run(
            command_args,
            capture_output=True,
            text=True,
            cwd=tmp_path,  # Ensure the working directory is the temp path
        )

        # Check the return code
        assert result.returncode == 0, f"Command failed with error:\n{result.stderr}"

        # Collect the list of generated files
        generated_files = [f.name for f in output_dir.iterdir() if f.is_file()]

        # Optionally, you can return the output directory path for further checks
        return generated_files, output_dir

    return _run_cli


@pytest.fixture
def resource_path():
    # Fetch the resource folder path from the environment variable
    resource_dir = os.getenv("LIONHEART_RESOURCE_DIR")
    if resource_dir is None:
        pytest.fail("Missing environment variable: `LIONHEART_RESOURCE_DIR`")
    if not os.path.exists(resource_dir):
        pytest.fail(f"Resource directory does not exist: {resource_dir}")
    return pathlib.Path(resource_dir)


@pytest.fixture
def lionheart_features():
    snyder_scores = [
        0.8141,
        1.057,
        0.7194,
        -1.1852,
        0.394,
        0.5002,
        0.7071,
        0.573,
        0.5877,
        0.4353,
        1.3857,
        0.353,
        -0.1709,
        -1.6836,
        -0.6119,
        -0.6327,
        -1.2363,
        -1.0459,
        -0.4535,
        -0.6351,
        -0.4473,
        -0.4835,
        0.3949,
        0.1288,
        0.5688,
        0.4552,
        -0.0011,
        0.5157,
        -0.3116,
        0.6709,
        -1.3317,
        -0.9362,
        -1.8214,
        -1.8534,
        -1.9366,
        0.709,
        0.2769,
        0.1859,
        0.4636,
        -0.7201,
        0.3565,
        0.4306,
        -0.1557,
        0.6696,
        0.1556,
        0.4485,
        0.4659,
        -2.3203,
        -1.1119,
        -0.4983,
        0.0495,
        -1.349,
        -0.2383,
        -1.921,
        -1.816,
        -1.754,
        -1.2112,
        -0.7896,
        -0.422,
        -2.151,
        -2.7219,
        -1.6541,
        -2.0681,
        -2.2274,
        -1.884,
        -1.8115,
        0.4876,
        -0.4927,
        -1.7157,
        0.8121,
        -0.6472,
        -0.5986,
        -2.0033,
        -0.7331,
        -0.0958,
        -0.2154,
        -0.3942,
        -0.0065,
        -1.4615,
        0.2164,
        0.7134,
        0.0131,
        0.3452,
        0.1675,
        -1.012,
        0.4835,
        -1.0144,
        -0.9813,
        0.3599,
        -1.3786,
        -1.3547,
        -1.8322,
        -1.8206,
        -2.104,
        -1.7245,
        -1.8829,
        0.4226,
        -1.1243,
        -0.1702,
        -0.5016,
        0.4652,
        0.7869,
        0.7079,
        0.3795,
        -0.1291,
        -0.0052,
        0.4497,
        0.3357,
        0.4331,
        0.1887,
        0.013,
        0.3635,
        -1.7338,
        -1.5252,
        0.8521,
        1.218,
        1.1333,
        0.3567,
        0.4657,
        0.131,
        1.3864,
        -2.1067,
        0.1387,
        -0.1336,
        -0.0418,
        0.2053,
        0.0077,
        -0.4345,
        1.1744,
        -0.9707,
        -1.4331,
        -0.4576,
        -0.4727,
        -0.295,
        -0.4923,
        -0.4639,
        0.019,
        -0.5572,
        -0.5442,
        -0.0136,
        0.1632,
        0.1528,
        -0.0205,
        -0.119,
        0.1335,
        -0.0323,
        -0.4719,
        -0.4038,
        -0.5839,
        -0.5848,
        -0.1144,
        -0.5794,
        -0.3856,
        -0.1944,
        -0.6862,
        -0.1942,
        -0.6543,
        -0.2987,
        -0.4191,
        -0.6512,
        -0.4383,
        -0.6515,
        0.0373,
        -0.4843,
        -0.4335,
        -0.5529,
        -0.4953,
        -0.3081,
        -0.4988,
        -0.6917,
        -0.6313,
        -0.5443,
        -0.7615,
        -0.4162,
        -0.5954,
        -0.3432,
        -0.5368,
        -0.6858,
        -0.679,
        -0.1406,
        -0.5919,
        0.5853,
        -1.9649,
        -1.3271,
        -0.5727,
        -1.2483,
        -0.4821,
        0.0225,
        0.1756,
        -1.8919,
        0.6344,
        -0.3147,
        -0.4153,
        -0.358,
        -0.046,
        0.6212,
        0.2279,
        -0.0563,
        -0.4756,
        0.204,
        0.4362,
        0.2748,
        0.348,
        -0.9727,
        0.1022,
        0.1343,
        -0.6654,
        -1.971,
        1.0367,
        1.251,
        -0.952,
        -1.5918,
        0.6621,
        -0.7925,
        -0.4703,
        0.0033,
        -0.1875,
        -0.5049,
        -0.5543,
        -0.3804,
        -0.365,
        -0.1746,
        -0.7278,
        -0.3185,
        -0.1987,
        -0.2111,
        -0.0893,
        -0.3851,
        -0.7737,
        -0.6384,
        -0.4375,
        -0.3627,
        -0.5027,
        -0.5633,
        -0.8046,
        -0.1335,
        -0.6238,
        -0.6183,
        -0.5261,
        -0.552,
        -0.4135,
        -0.5742,
        -0.8277,
        -0.5394,
        -0.429,
        -0.4747,
        -0.684,
        -0.34,
        -0.3646,
        -0.5889,
        -0.3425,
        -0.06,
        -0.5627,
        -0.1579,
        -0.3908,
        -0.5714,
        0.0103,
        -0.2088,
        -0.599,
        0.0084,
        -0.662,
        0.8888,
        -0.8622,
        -1.5979,
        -0.2235,
        0.0251,
        -0.4972,
        -0.8941,
        -0.6555,
        -1.441,
        0.5361,
        0.3335,
        -1.38,
        -2.3143,
        -1.7418,
        -1.4732,
        -2.5934,
        0.6553,
        0.6909,
        0.365,
        0.6789,
        -0.0986,
        -1.289,
        0.0371,
        -1.1923,
        -0.3151,
        -1.118,
        -0.6489,
        0.0695,
        -1.6698,
        0.0861,
        -0.7509,
        -1.0846,
        -0.023,
        -0.6839,
        -0.7297,
        -0.3119,
        -1.9317,
        1.0243,
        -2.1169,
        -0.6187,
        -0.9978,
        -1.8134,
        1.2209,
        0.9944,
        -0.4154,
        -0.6867,
        -1.6296,
        0.8857,
        -0.0636,
        0.0526,
        -1.5213,
        0.1796,
        0.6042,
        -2.0226,
        -0.6217,
        -1.0981,
        -1.0644,
        -1.1839,
        0.134,
        -0.9546,
        -0.2234,
        -1.5954,
        -0.5461,
        0.7937,
        -1.1305,
        -0.108,
        -1.5224,
        -1.3689,
        0.298,
        -1.059,
        0.3139,
        0.2898,
        -1.805,
        0.4453,
        -1.781,
        -0.1021,
        -1.4601,
        0.0025,
        0.5285,
        -0.2756,
        -0.4429,
        -0.0507,
        0.1069,
        -0.4252,
        -0.1448,
        0.1235,
        0.298,
        0.0973,
        0.1038,
        0.1971,
        0.1471,
        0.5603,
        -0.0013,
        -0.2192,
        0.0245,
        -0.2044,
        -0.3255,
        0.8697,
        -0.4742,
        -0.117,
        -0.3754,
        -0.5956,
        -0.4204,
        0.804,
        -0.7948,
        -0.0018,
        -0.9858,
        -0.7442,
        0.0417,
        -0.7455,
        -1.5145,
        -2.1141,
        -0.1287,
        0.0095,
        -0.017,
        -0.7388,
        0.419,
        0.5231,
        -1.8384,
        -2.4136,
        -1.7267,
        -2.5124,
        -1.3432,
        -1.9386,
        -1.9524,
        0.1824,
        -0.3321,
        0.5314,
        -0.7989,
        -0.4141,
        -1.9124,
        -0.133,
        -3.2591,
        2.2788,
        1.7967,
        0.4795,
        -1.2346,
        0.094,
        -0.239,
        0.2942,
        -0.306,
        -0.1328,
        0.8062,
        -1.3587,
        -0.6022,
        -2.2058,
        -1.7822,
        -2.269,
        -0.6909,
        -1.8774,
        -1.8014,
        -1.8026,
        -2.3727,
        -2.63,
        -1.916,
        0.1337,
        -0.3241,
        -0.8084,
        0.6492,
        1.4157,
        1.1455,
        -1.2242,
        0.9218,
        -0.0251,
        0.794,
        0.4425,
        0.5513,
        -0.1374,
        -0.1607,
        0.2921,
        0.3903,
        -0.082,
        -0.2777,
        -0.3706,
        0.7458,
        0.0657,
        0.5472,
        0.1101,
        -2.4779,
        -1.687,
        -1.6038,
        0.8204,
        0.6484,
        -0.105,
        0.2426,
        0.3299,
        -0.8623,
        -1.1731,
        1.0172,
        0.6362,
        -1.5389,
        -1.233,
        -0.6559,
        -0.392,
        -0.2945,
        0.4739,
        0.388,
        -0.067,
        0.2499,
        0.7856,
        -1.0197,
        -2.0832,
        -0.0393,
        -0.0777,
        0.3167,
        -0.3003,
        -0.433,
        0.7009,
        0.3476,
        0.4167,
        0.2675,
        -1.1552,
        -0.6544,
        -1.1736,
        0.6492,
        0.7116,
        -0.1998,
        0.1255,
        -0.0364,
        -0.141,
        0.2316,
        0.0425,
        0.6847,
        0.7313,
        0.2305,
        0.7344,
        -1.0423,
        0.8883,
        0.5272,
        1.8046,
        0.2138,
        2.0018,
        -2.4808,
        -0.537,
        -2.0913,
        0.4036,
        -0.3797,
        -0.7748,
        -0.5189,
        0.0901,
        0.0168,
        -0.0597,
        -1.7041,
        -1.4373,
        -0.5248,
        -1.3153,
        -0.7476,
        0.0114,
        0.135,
        0.2119,
        -1.232,
        -1.8282,
        -1.2799,
        -1.9098,
        -2.0075,
        0.3213,
        -0.3165,
        -2.2923,
        -0.6079,
        0.2532,
        0.1985,
        0.5212,
        -0.6929,
        -0.1172,
        -1.5323,
        -0.9029,
        -1.3616,
        -1.5648,
        0.2584,
        -0.1526,
        -1.5179,
        -0.1154,
        -0.3326,
        -0.0199,
        0.0721,
        -0.0035,
        -0.2091,
        0.7372,
        0.791,
        0.9702,
        0.6953,
        0.3109,
        -0.055,
        0.5557,
        1.0517,
        0.1917,
        0.2472,
        0.3364,
        -0.4556,
        -0.3216,
        -0.9696,
        -0.2182,
        -0.9157,
        -0.2534,
        0.3361,
        -0.8053,
        -0.784,
        -0.5737,
        -1.0995,
        -1.0779,
        -0.7228,
        -0.72,
        1.1349,
        0.7589,
        0.2326,
        1.407,
        0.9224,
        1.0108,
        0.4903,
        1.0284,
        1.323,
        1.2181,
        0.4429,
        1.5356,
        1.0062,
        1.6388,
        1.87,
        1.5258,
        1.0911,
        1.3596,
        1.1429,
        -0.8505,
        1.1643,
        1.3992,
        0.6624,
        0.9532,
        0.8362,
        0.7502,
        1.6731,
        1.7243,
        0.9995,
        0.8758,
        0.3781,
        0.6101,
        1.2182,
        0.9183,
        0.9262,
        1.8189,
        -1.0808,
        -1.2762,
        -0.5703,
        -1.0419,
        -0.7419,
        -0.8721,
        -0.2227,
        -0.9699,
        -1.2071,
        -0.8381,
        1.0362,
        1.1557,
        1.7671,
        0.7592,
        1.2093,
        -0.1616,
        1.0373,
        0.9423,
        -0.7153,
        -1.1266,
        1.4431,
        0.7137,
        1.4178,
        0.81,
        1.0375,
        0.6081,
        0.5945,
        -0.303,
        0.5555,
        1.2867,
        -1.0234,
        -1.2229,
        -1.3901,
        1.4573,
        0.9256,
        0.8908,
        1.0262,
        2.178,
        -0.0307,
        0.4715,
        0.6676,
        1.6814,
        1.4066,
        1.0879,
        2.8279,
        0.9785,
        0.7311,
        1.4816,
        1.2149,
        1.6004,
        1.4337,
        0.9014,
        1.3701,
        1.357,
        1.0792,
        0.9953,
        1.4937,
        1.1581,
        1.3087,
        1.3834,
        0.6542,
        1.7025,
        1.0806,
        0.8837,
        1.8803,
        1.3904,
        0.9532,
        -0.2592,
        1.1037,
        0.9048,
        -0.7158,
        0.482,
        1.0483,
        1.0037,
        1.1609,
        0.8674,
        0.0475,
        -0.0594,
        1.4213,
        0.0182,
        0.0227,
        0.0999,
        0.0192,
        -0.268,
        -0.0155,
        0.0613,
        -0.3875,
        1.3494,
        1.201,
        0.9465,
        0.6415,
        0.3978,
        2.3428,
        0.8518,
        0.8379,
        0.9379,
        0.4676,
        0.1315,
        0.3256,
        0.0629,
        0.4056,
        0.3767,
        0.4611,
        0.2311,
        1.0638,
        -0.5088,
        0.4309,
        0.7912,
        0.7446,
        0.4455,
        0.8835,
        0.4712,
        -0.0127,
        -1.0397,
        0.4698,
        0.9069,
        1.0193,
        0.3227,
        0.4017,
        0.0867,
        0.295,
        -0.9714,
        1.3314,
        -0.2098,
        0.982,
        0.9453,
        0.8044,
        0.8133,
        1.3509,
        2.3425,
        0.5122,
        0.6776,
        0.6762,
        -0.731,
        1.0154,
        0.1147,
        1.4757,
        0.2428,
        0.9352,
        1.431,
        0.8846,
        0.9035,
        0.7209,
        0.5396,
        0.5239,
        0.0586,
        1.5684,
        0.8222,
        -0.1954,
        1.1574,
        0.3022,
        1.0591,
        -0.5529,
        -0.1791,
        0.6192,
        1.0892,
        1.1698,
        0.3739,
        1.4658,
        0.5659,
        2.397,
        1.2535,
        0.6738,
        0.4706,
        0.3847,
        0.9129,
        1.5466,
        0.9267,
        1.0756,
        1.418,
        -1.2042,
        0.8401,
        1.6974,
        1.9124,
        0.5258,
        1.5203,
        0.1316,
        0.2545,
        0.4611,
        0.217,
        0.2029,
        0.3265,
        1.4035,
        1.542,
        1.127,
        -1.4814,
        -1.1427,
        -1.491,
        -1.302,
        -1.6391,
        -1.2345,
        -0.3175,
        -0.6224,
        -0.1304,
        1.4388,
        0.72,
        0.2108,
        0.4147,
        -0.2154,
        0.8977,
        0.0844,
        1.0325,
        0.8744,
        -0.5276,
        1.3598,
        -0.1381,
        0.2001,
        0.2756,
        0.6467,
        1.5726,
        0.9329,
        2.5697,
        0.8608,
        0.4385,
        0.6703,
        1.7555,
        -0.0667,
        1.5735,
        0.9155,
        0.6159,
        0.3086,
        0.7247,
        1.5655,
        0.0096,
        1.4763,
        0.0136,
        0.6659,
        1.4937,
        1.8637,
        1.1695,
        0.8892,
        1.07,
        -0.2417,
        1.7351,
        0.2077,
        -0.2191,
        -0.2793,
        0.968,
        0.1829,
        1.265,
        0.377,
        0.6142,
        1.5693,
        0.9758,
        1.2421,
        1.3289,
        0.7934,
        1.1022,
        1.1413,
        0.7243,
        1.0053,
        1.207,
        2.1524,
        0.7468,
        0.8812,
        1.7753,
        0.7072,
        2.0292,
        -0.2361,
        1.9474,
        -0.8691,
        -0.8629,
        -0.1094,
        -0.6231,
        -0.8789,
        -0.5314,
        1.6235,
        1.235,
        -0.1295,
        1.49,
        0.0725,
        0.999,
        -0.9054,
        -0.7332,
        -1.1621,
        -0.7867,
        -0.7704,
        -0.9493,
        -0.8656,
        0.0227,
        0.5511,
        2.6359,
        -0.6987,
        1.2052,
        3.2141,
        2.4845,
        1.2544,
        0.7416,
        1.4008,
        1.7696,
        1.6429,
        1.0987,
        1.3726,
        0.7477,
        0.7176,
        0.4164,
        1.3824,
        0.7173,
        0.6332,
    ]
    return snyder_scores
